<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Google Map</title>
</head>
<body>

    <div id="map" style="width:100%;height:600px"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script>
        $(document).ready(function(){

            function mapInit(){
                var m,data = {};
                data.center = new google.maps.LatLng(40.1770,44.5148);
                data.zoom = 16;
                data.mapTypeId = google.maps.MapTypeId.ROADMAP;
                m = new google.maps.Map($('#map')[0],data);
                return m;
            }
            var map = mapInit();

            var socket = io();
            var markers = [];
            socket
                .on('connect', function () {
                    console.log('socket connected...')
                })
                .on('disconnect',function(){
                    console.log('socket disconnected...');
                })
                .on('message',function(data){
                    console.log('message',data);

                    if(!markers[data.IMEI]) {
                        var pos = new google.maps.LatLng(data.latitude / 10000000, data.longitude / 10000000);
                        var marker = new google.maps.Marker({
                            position: pos
                        });
                        marker.setMap(map);
                        map.setCenter(pos);
                        markers[data.IMEI] = marker;
                    }
                    else {
                        var pos = new google.maps.LatLng(data.latitude / 10000000, data.longitude / 10000000);
                        markers[data.IMEI].setPosition(pos);
                        map.setCenter(pos);
                    }
                });
        });
    </script>
</body>
</html>